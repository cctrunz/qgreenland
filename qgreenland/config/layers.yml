# A layer has exactly one pipeline.
#   - A pipeline has many jobs...
#     ? A job has zero to many datasources??
# A layer has one or many datasources.
#   ? Should the _pipeline_ or _job_ have datasources instead?
#   - A datasource has exactly one provider.
#   - A datasource has one or many files.
# A layer has exactly one layer group.
# TODO layers.yml:
# - ingest_task -> pipeline; have a dir called "pipelines" for
#   pipeline class definitions. Current terminology is "layer" but
#   that's a QGIS concept.
# - Extract `file_type`, `data_type` attributes to pipeline
#   code/configuration
# TODO other:
# - New `pipelines.yml` configuration: TBD?
#


################
# Science Data #
################

- &glacier_terminus
  id: glacier_terminus_glacier_ids
  data_source: glacier_terminus.glacier_ids
  ingest_task: glacier_terminus
  title: 'Glacier IDs'
  file_type: '.shp'
  data_type: 'vector'
  group_path: 'Glaciology/Glacier Terminus'
  visible: True


- <<: *glacier_terminus
  id: glacier_terminus
  data_source:
    - glacier_terminus.2000_2001
    - glacier_terminus.2005_2006
    - glacier_terminus.2006_2007
    - glacier_terminus.2007_2008
    - glacier_terminus.2008_2009
    - glacier_terminus.2012_2013
    - glacier_terminus.2014_2015
    - glacier_terminus.2015_2016
    - glacier_terminus.2016_2017
  title: 'Glacier Termini'


- id: velocity_mosaic
  data_source: velocity_mosaic.only
  ingest_task: velocity_mosaic
  ingest_task_kwargs: {'extract_dataset': 'v'}
  file_type: '.tif'
  data_type: 'raster'
  title: 'Ice Sheet Velocity'
  style: 'ice_sheet_velocity'
  overviews_kwargs:
    overview_levels: [2, 4, 8, 16]
    resampling_method: average
  warp_kwargs:
    xRes: 500
    yRes: 500
  visible: True
  # TODO: Does this count as glaciology?
  group_path: 'Cryosphere/Ice Sheet Velocity'


- &bedmachine
  id: bedmachine_bed
  data_source: bedmachine.only
  ingest_task: bedmachine
  ingest_task_kwargs: {'extract_dataset': 'bed'}
  file_type: '.tif'
  data_type: 'raster'
  title: 'Bedrock Elevation'
  style: 'bedmachine_bed'
  warp_kwargs:
    xRes: 1000
    yRes: 1000
  visible: True
  group_path: 'Geophysics/IceBridge BedMachine'


- <<: *bedmachine
  id: bedmachine_surface
  ingest_task_kwargs: {'extract_dataset': 'surface'}
  title: 'Surface Elevation'
  style: null
  visible: False


- <<: *bedmachine
  id: bedmachine_thickness
  ingest_task_kwargs: {'extract_dataset': 'thickness'}
  title: 'Ice Thickness'
  style: null
  visible: False


- id: hydrologic_subbasins
  data_source: hydrologic_subbasins.only
  ingest_task: rarred_shapefile
  file_type: '.shp'
  data_type: 'vector'
  title: 'Hydrologic Sub-Basins'
  visible: False
  group_path: 'Hydrology'
  override_source_projection: 'ESRI:102018'


############
# BASEMAPS #
############


- id: populated_places
  data_source: populated_places.only
  ingest_task: zipped_shapefile
  file_type: '.shp'
  data_type: 'vector'
  title: 'Populated Places'
  # style: 'populated_places'
  subset_kwargs:
    xmin: -796814.1
    ymin: -322934.6
    xmax: 1103185.9
    ymax: -3599419.2
  # TODO: Enable a style with labels for placenames, make visible again
  visible: False
  group_path: 'Basemaps'


- id: coastlines
  data_source: coastlines.only
  ingest_task: zipped_shapefile
  file_type: '.shp'
  data_type: 'vector'
  title: 'Coastlines'
  visible: False
  group_path: 'Basemaps'


# NOTE: We attempted to add the corresponding NE Ocean layer, but it included
# holes for small islands which are not present on the land layer, and that was
# gross so we removed the ocean layer.
- id: land
  data_source: land_shape.only
  ingest_task: zipped_shapefile
  file_type: '.shp'
  data_type: 'vector'
  title: 'Land'
  style: 'land'
  visible: True
  group_path: 'Basemaps'


- id: arctic_dem
  data_source: arctic_dem.only
  ingest_task: arctic_dem
  file_type: '.tif'
  data_type: 'raster'
  title: 'Arctic DEM (1km mosaic)'
  style: 'arctic_dem'
  overviews_kwargs:
    overview_levels: [2, 4, 8, 16]
    resampling_method: average
  visible: False
  group_path: 'Basemaps'


- id: background
  data_source: background.only
  ingest_task: background_image
  file_type: '.tif'
  data_type: 'raster'
  title: 'Background'
  # NOTE: Without passing warp_kwargs, we get a black image.
  # TODO: Which of these args are necessary to avoid that?
  warp_kwargs:
    xRes: 1000
    yRes: 1000
    # Attempt to avoid pole hole and nodata line where east and west edges of
    # the original image meet after polar wrapping. TODO: This doesn't actually
    # get rid of the line.
    warpOptions: ['SOURCE_EXTRA=100', 'SAMPLE_GRID=YES']
  visible: True
  group_path: 'Basemaps'
